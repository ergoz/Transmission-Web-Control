var transmission={SessionId:"",isInitialized:false,host:"",port:"9091",path:"/transmission/rpc",fullpath:"",on:{torrentCountChange:null,postError:null},username:"",password:"",_status:{stopped:0,checkwait:1,check:2,downloadwait:3,download:4,seedwait:5,seed:6,actively:101},headers:{},trackers:{},islocal:false,downloadDirs:[],getSessionId:function(b,a){jQuery.ajax({type:"POST",url:this.fullpath,error:function(d){var c="";if(d.status===409&&(c=d.getResponseHeader("X-Transmission-Session-Id"))){b.isInitialized=
true;b.SessionId=c;b.headers["X-Transmission-Session-Id"]=c;a&&a()}},headers:this.headers})},init:function(b,a){jQuery.extend(this,b);if(this.islocal==true)this.fullpath=this.path;else{if(this.fullpath=="")this.fullpath=this.host+(this.port?":"+this.port:"")+this.path;if(this.username&&this.password)this.headers.Authorization="Basic "+(new Base64).encode(this.username+":"+this.password)}this.getSessionId(this,a)},exec:function(b,a){if(!this.isInitialized)return false;var d={method:"",arguments:{},
tag:""};jQuery.extend(d,b);var c={type:"POST",url:this.fullpath,dataType:"json",data:JSON.stringify(d),success:function(e){a&&a(e)},error:function(e){var f="";if(e.status===409&&(f=e.getResponseHeader("X-Transmission-Session-Id"))){transmission.SessionId=f;transmission.headers["X-Transmission-Session-Id"]=f;jQuery.ajax(c)}else transmission.on.postError&&transmission.on.postError(e)},headers:this.headers};jQuery.ajax(c)},getStatus:function(b){this.exec({method:"session-stats"},function(a){if(a.result==
"success"){b&&b(a.arguments);if(transmission.torrents.count!=a.arguments.torrentCount||transmission.torrents.activeTorrentCount!=a.arguments.activeTorrentCount||transmission.torrents.pausedTorrentCount!=a.arguments.pausedTorrentCount){transmission.torrents.count=a.arguments.torrentCount;transmission.torrents.activeTorrentCount=a.arguments.activeTorrentCount;transmission.torrents.pausedTorrentCount=a.arguments.pausedTorrentCount;transmission._onTorrentCountChange()}}})},getSession:function(b){this.exec({method:"session-get"},
function(a){a.result=="success"&&b&&b(a.arguments)})},addTorrentFromUrl:function(b,a,d,c){this.exec({method:"torrent-add",arguments:{filename:b,"download-dir":a,paused:!d}},function(e){switch(e.result){case "success":c&&c(e.arguments["torrent-added"]);break;case "duplicate torrent":c&&c("duplicate")}})},_onTorrentCountChange:function(){this.torrents.loadSimpleInfo=false;this.on.torrentCountChange&&this.on.torrentCountChange()},removeTorrent:function(b,a,d){transmission.exec({method:"torrent-remove",
arguments:{ids:b,"delete-local-data":a}},function(c){d&&d(c.result)})}};(function(b){for(var a=b("script"),d=-1,c=0;c<a.length;c++){d=a[c].src.toLowerCase().indexOf("min/transmission.js");if(d!=-1){b.getScript("script/min/transmission.torrents.js");break}}d==-1&&b.getScript("script/transmission.torrents.js")})(jQuery);
